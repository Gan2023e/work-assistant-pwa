# 复选框功能修复说明

## 修复的问题

### 1. ✅ 点击母SKU行的复选框没有反应
**问题分析**: 母SKU复选框的点击事件没有正确处理

**解决方案**: 
- 在`onSelect`函数中添加了对母SKU行的特殊处理逻辑
- 当点击母SKU复选框时，自动选择/取消选择所有对应的子SKU
- 确保母SKU和子SKU的选择状态正确同步

### 2. ✅ 勾选母SKU下的全部子SKU后，母SKU复选框没有被勾选
**问题分析**: `getCheckboxProps`函数的状态计算逻辑有缺陷

**解决方案**:
- 重写了`getCheckboxProps`函数的状态计算逻辑
- 正确计算母SKU复选框的三种状态：
  - `checked: false, indeterminate: false` - 没有子SKU被选中
  - `checked: true, indeterminate: false` - 所有子SKU都被选中
  - `checked: false, indeterminate: true` - 部分子SKU被选中（半选状态）

### 3. ✅ 表头全选复选框不能取消已选择的子SKU
**问题分析**: 缺少`onSelectAll`函数来处理表头全选逻辑

**解决方案**:
- 添加了`onSelectAll`函数处理表头全选/取消全选功能
- 实现了正确的全选逻辑：
  - **全选时**: 获取当前页面所有子SKU，包括展开和未展开的
  - **取消全选时**: 清空所有选择状态

## 技术实现详情

### 修复后的选择逻辑结构
```typescript
const handleRowSelection = {
  selectedRowKeys,
  onChange: (newSelectedRowKeys, newSelectedRows) => {
    // 过滤掉母SKU的keys，只保留子SKU
    const childKeys = newSelectedRowKeys.filter(key => !key.startsWith('parent-'));
    const childRows = newSelectedRows.filter(row => row && !row.isParentRow);
    
    setSelectedRowKeys(childKeys);
    setSelectedRows(childRows);
  },
  
  onSelect: (record, selected) => {
    if (record.isParentRow) {
      // 母SKU选择逻辑：联动选择所有子SKU
    } else {
      // 子SKU选择逻辑：单独选择
    }
  },
  
  onSelectAll: (selected, selectedRows, changeRows) => {
    // 表头全选/取消全选逻辑
    if (selected) {
      // 获取所有子SKU并选择
    } else {
      // 取消所有选择
    }
  },
  
  getCheckboxProps: (record) => {
    if (record.isParentRow) {
      // 计算母SKU复选框状态：全选/半选/未选
    }
    return { checked: selectedRowKeys.includes(record.key!) };
  }
};
```

### 状态管理优化
- **selectedRowKeys**: 只存储子SKU的keys，不包含母SKU的keys
- **selectedRows**: 只存储子SKU的数据记录
- **母SKU状态**: 通过计算其子SKU的选择情况动态确定

### 用户体验改进
- **直观的母SKU控制**: 点击母SKU复选框可以一键选择/取消选择所有子SKU
- **智能的状态反馈**: 母SKU复选框会根据子SKU选择情况显示正确的状态
- **完整的全选功能**: 表头全选可以正确选择/取消选择所有可见和隐藏的子SKU
- **一致的交互体验**: 所有复选框操作都符合用户预期

## 测试建议

### 功能测试用例
1. **母SKU复选框测试**:
   - ✅ 点击母SKU复选框，所有子SKU应该被选中
   - ✅ 再次点击母SKU复选框，所有子SKU应该被取消选择

2. **子SKU选择反馈测试**:
   - ✅ 手动选择母SKU下的所有子SKU，母SKU复选框应该变为选中状态
   - ✅ 取消选择任一子SKU，母SKU复选框应该变为半选状态
   - ✅ 取消选择所有子SKU，母SKU复选框应该变为未选状态

3. **表头全选测试**:
   - ✅ 点击表头全选，当前页面所有子SKU（包括未展开的）应该被选中
   - ✅ 再次点击表头全选，所有选择应该被取消
   - ✅ 部分选择后点击表头全选，应该能正确切换状态

## 提交记录
```
c775808 修复复选框功能：1.添加onSelectAll函数处理表头全选 2.修复母SKU和子SKU的选择逻辑 3.确保复选框状态正确更新
```

所有复选框功能现在都应该正常工作！🎉 