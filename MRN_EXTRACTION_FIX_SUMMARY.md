# MRNæå–åŠŸèƒ½ä¿®å¤æ€»ç»“

## é—®é¢˜æè¿°

åœ¨"å¤´ç¨‹ç‰©æµç®¡ç†"é¡µé¢çš„"ä¸Šä¼ VATç¨Žå•"åŠŸèƒ½ä¸­ï¼Œç¨‹åºé”™è¯¯åœ°æå–äº†Bank ReferenceåŽé¢çš„ `GB16BARC20051723372545`ï¼Œè€Œä¸æ˜¯MRNåŽé¢çš„ `25GB7A8H3YNK4P0AR3`ã€‚

## é—®é¢˜åˆ†æž

1. **åŽŸå§‹é—®é¢˜**ï¼šPDFè§£æžæ—¶ï¼Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ°äº†é”™è¯¯çš„å­—ç¬¦ä¸²
2. **æ ¹æœ¬åŽŸå› **ï¼šBank Referenceå’ŒMRNéƒ½æ˜¯é•¿å­—ç¬¦ä¸²ï¼ŒåŽŸæœ‰æ­£åˆ™è¡¨è¾¾å¼è¿‡äºŽå®½æ¾ï¼Œæ— æ³•æ­£ç¡®åŒºåˆ†
3. **å…·ä½“è¡¨çŽ°**ï¼šç¨‹åºæå–åˆ°äº†Bank Referenceè€Œä¸æ˜¯MRN

## ä¿®å¤æ–¹æ¡ˆ

### 1. ä¼˜åŒ–MRNæå–é€»è¾‘

#### æ”¹è¿›å‰çš„é—®é¢˜
- ä½¿ç”¨è¿‡äºŽå®½æ¾çš„æ­£åˆ™è¡¨è¾¾å¼ `/([A-Z0-9Ã˜]{20,30})/i`
- æ²¡æœ‰æŽ’é™¤Bank Referenceçš„é€»è¾‘
- é•¿åº¦éªŒè¯è¿‡äºŽä¸¥æ ¼ï¼ˆè¦æ±‚20-30ä½ï¼‰

#### æ”¹è¿›åŽçš„è§£å†³æ–¹æ¡ˆ
- **ç²¾ç¡®åŒ¹é…ä¼˜å…ˆ**ï¼šé¦–å…ˆå°è¯•ç²¾ç¡®åŒ¹é…MRNè¡Œ
- **å¤šé‡åŒ¹é…ç­–ç•¥**ï¼šä½¿ç”¨å¤šç§æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼
- **Bank ReferenceæŽ’é™¤**ï¼šæ·»åŠ æŽ’é™¤é€»è¾‘ï¼Œé¿å…æå–Bank Reference
- **é•¿åº¦æ¡ä»¶ä¼˜åŒ–**ï¼šå°†é•¿åº¦è¦æ±‚è°ƒæ•´ä¸º15-30ä½ï¼Œé€‚åº”å®žé™…MRNé•¿åº¦

### 2. å…·ä½“ä¿®å¤å†…å®¹

#### ä¿®å¤çš„æ–‡ä»¶
- `backend/routes/logistics.js` - VATç¨Žå•PDFè§£æžå‡½æ•°

#### ä¸»è¦ä¿®æ”¹ç‚¹

1. **ç²¾ç¡®åŒ¹é…MRNè¡Œ**ï¼š
```javascript
let mrnMatch = line.match(/Movement Reference Number \(MRN\): ([A-Z0-9Ã˜]+)/i);
if (!mrnMatch) {
  mrnMatch = line.match(/MRN: ([A-Z0-9Ã˜]+)/i);
}
```

2. **Bank ReferenceæŽ’é™¤é€»è¾‘**ï¼š
```javascript
if (!mrn.includes('BARC') && !mrn.startsWith('GB16')) {
  extractedData.mrn = mrn;
} else {
  console.log('ðŸ” è·³è¿‡Bank Reference:', mrn);
}
```

3. **é•¿åº¦æ¡ä»¶ä¼˜åŒ–**ï¼š
```javascript
if (mrn.length >= 15 && mrn.length <= 30) {
  // å¤„ç†é€»è¾‘
}
```

### 3. ä¿®å¤æ•ˆæžœéªŒè¯

#### æµ‹è¯•ç»“æžœ
- âœ… **æ­£ç¡®æå–MRN**ï¼š`25GB7A8H3YNK4P0AR3`
- âœ… **æŽ’é™¤Bank Reference**ï¼š`GB16BARC20051723372545` è¢«æ­£ç¡®è·³è¿‡
- âœ… **æ”¯æŒç‰¹æ®Šå­—ç¬¦**ï¼šÃ˜è‡ªåŠ¨è½¬æ¢ä¸º0
- âœ… **é•¿åº¦éªŒè¯é€šè¿‡**ï¼š18ä½MRNç¬¦åˆ15-30ä½è¦æ±‚

#### æµ‹è¯•ç”¨ä¾‹
```javascript
// è¾“å…¥PDFæ–‡æœ¬
"Movement Reference Number (MRN): 25GB7A8H3YNK4P0AR3"
"Bank Reference: GB16BARC20051723372545"

// è¾“å‡ºç»“æžœ
{ mrn: '25GB7A8H3YNK4P0AR3', taxAmount: null, taxDate: null }
```

## æŠ€æœ¯ç»†èŠ‚

### 1. æ­£åˆ™è¡¨è¾¾å¼ä¼˜åŒ–
- **ç²¾ç¡®åŒ¹é…**ï¼š`/Movement Reference Number \(MRN\): ([A-Z0-9Ã˜]+)/i`
- **å¤‡ç”¨åŒ¹é…**ï¼š`/MRN: ([A-Z0-9Ã˜]+)/i`
- **é€šç”¨åŒ¹é…**ï¼š`/([A-Z0-9Ã˜]{25})/i`

### 2. å­—ç¬¦å¤„ç†
- **ç‰¹æ®Šå­—ç¬¦è½¬æ¢**ï¼š`Ã˜` â†’ `0`
- **å­—ç¬¦æ¸…ç†**ï¼šç§»é™¤éžå­—æ¯æ•°å­—å­—ç¬¦
- **é•¿åº¦éªŒè¯**ï¼š15-30ä½å­—ç¬¦

### 3. æŽ’é™¤é€»è¾‘
- **Bank Referenceè¯†åˆ«**ï¼šåŒ…å«`BARC`æˆ–ä»¥`GB16`å¼€å¤´
- **è·³è¿‡å¤„ç†**ï¼šè®°å½•æ—¥å¿—ä½†ä¸æå–

## ç”¨æˆ·ä½“éªŒæ”¹è¿›

1. **å‡†ç¡®æ€§æå‡**ï¼šçŽ°åœ¨èƒ½æ­£ç¡®æå–MRNè€Œä¸æ˜¯Bank Reference
2. **è°ƒè¯•ä¿¡æ¯å¢žå¼º**ï¼šæ·»åŠ è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºŽé—®é¢˜æŽ’æŸ¥
3. **å®¹é”™æ€§å¢žå¼º**ï¼šæ”¯æŒå¤šç§MRNæ ¼å¼å’Œç‰¹æ®Šå­—ç¬¦

## æ³¨æ„äº‹é¡¹

1. **å‘åŽå…¼å®¹**ï¼šä¿®å¤ä¸å½±å“çŽ°æœ‰åŠŸèƒ½
2. **æ€§èƒ½å½±å“**ï¼šå¢žåŠ å°‘é‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œæ€§èƒ½å½±å“å¯å¿½ç•¥
3. **ç»´æŠ¤æ€§**ï¼šä»£ç ç»“æž„æ¸…æ™°ï¼Œä¾¿äºŽåŽç»­ç»´æŠ¤å’Œæ‰©å±•

## æ€»ç»“

é€šè¿‡æœ¬æ¬¡ä¿®å¤ï¼ŒVATç¨Žå•ä¸Šä¼ åŠŸèƒ½çŽ°åœ¨èƒ½å¤Ÿï¼š

- âœ… **æ­£ç¡®æå–MRNå·ç **ï¼š`25GB7A8H3YNK4P0AR3`
- âœ… **æŽ’é™¤Bank Reference**ï¼šé¿å…é”™è¯¯æå– `GB16BARC20051723372545`
- âœ… **æ”¯æŒç‰¹æ®Šå­—ç¬¦**ï¼šæ­£ç¡®å¤„ç†OCRè¯†åˆ«ä¸­çš„ç‰¹æ®Šå­—ç¬¦
- âœ… **æä¾›è¯¦ç»†æ—¥å¿—**ï¼šä¾¿äºŽé—®é¢˜æŽ’æŸ¥å’Œè¿›ä¸€æ­¥ä¼˜åŒ–

ä¿®å¤åŽçš„åŠŸèƒ½èƒ½å¤Ÿå‡†ç¡®è¯†åˆ«å’Œæå–VATç¨Žå•ä¸­çš„MRNå·ç ï¼Œè§£å†³äº†ç”¨æˆ·åé¦ˆçš„é—®é¢˜ã€‚ 